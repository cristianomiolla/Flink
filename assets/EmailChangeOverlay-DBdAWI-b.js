import{u as p,r as s,j as e,s as w,v as N}from"./index-D6Da1cw0.js";function k({isOpen:i,onClose:t}){const{user:c}=p(),[o,u]=s.useState({newEmail:""}),[n,l]=s.useState({}),[m,h]=s.useState(!1),[v,f]=s.useState("");s.useEffect(()=>{i||(u({newEmail:""}),l({}),f(""))},[i]),s.useEffect(()=>(i?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[i]),s.useEffect(()=>{const a=r=>{r.key==="Escape"&&t()};return i&&document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[i,t]);const x=()=>{const a={};return o.newEmail?N(o.newEmail)?o.newEmail===c?.email&&(a.newEmail="La nuova email deve essere diversa da quella attuale"):a.newEmail="Email non valida":a.newEmail="Nuova email richiesta",l(a),Object.keys(a).length===0},b=async a=>{if(a.preventDefault(),!!x()&&!(m||!c)){h(!0),l({});try{const{error:r}=await w.auth.updateUser({email:o.newEmail},{emailRedirectTo:"https://cristianomiolla.github.io/Skunk/"});if(r){r.message.includes("email_address_taken")?l({newEmail:"Questa email è già utilizzata da un altro account"}):l({general:r.message});return}f("Email di conferma inviata! Controlla sia la VECCHIA che la NUOVA casella postale e clicca sui link di conferma in entrambe per completare il cambio."),setTimeout(()=>{t()},5e3)}catch{l({general:"Si è verificato un errore. Riprova."})}finally{h(!1)}}},g=(a,r)=>{u(d=>({...d,[a]:r})),n[a]&&l(d=>{const E={...d};return delete E[a],E})},j=a=>{a.target===a.currentTarget&&t()};return i?e.jsx("div",{className:"auth-overlay",onClick:j,children:e.jsxs("div",{className:"auth-modal",children:[e.jsx("div",{className:"auth-header-sticky",children:e.jsx("button",{className:"auth-close-btn",onClick:t,children:"×"})}),e.jsx("div",{className:"auth-modal-header"}),e.jsxs("div",{className:"auth-content",children:[e.jsxs("div",{className:"header-card",children:[e.jsx("h2",{children:"CAMBIA EMAIL"}),e.jsx("p",{children:"Aggiorna l'indirizzo email del tuo account"})]}),n.general&&e.jsx("div",{className:"auth-error",children:n.general}),v&&e.jsxs("div",{className:"auth-success",children:[v,e.jsxs("div",{style:{marginTop:"1rem",fontSize:"13px",lineHeight:"1.4"},children:[e.jsx("strong",{children:"IMPORTANTE:"}),e.jsx("br",{}),"• Controlla la tua vecchia email (",c?.email,") e clicca il link di conferma",e.jsx("br",{}),"• Controlla la tua nuova email e clicca il link di conferma",e.jsx("br",{}),"• Solo dopo aver confermato entrambe potrai accedere con la nuova email",e.jsx("br",{}),"• Fino ad allora continuerai ad accedere con la vecchia email",e.jsx("br",{}),"• La sincronizzazione del profilo avverrà automaticamente dopo la conferma"]})]}),e.jsxs("form",{className:"auth-form",onSubmit:b,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Email attuale"}),e.jsx("div",{className:"current-email-display",children:c?.email||"N/A"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"form-label",htmlFor:"newEmail",children:["Nuova email ",e.jsx("span",{className:"required-indicator",children:"*"})]}),e.jsx("input",{id:"newEmail",type:"email",className:`form-input ${n.newEmail?"error":""}`,value:o.newEmail,onChange:a=>g("newEmail",a.target.value),placeholder:"Inserisci la nuova email",disabled:m}),n.newEmail&&e.jsx("div",{className:"form-error",children:n.newEmail})]}),e.jsxs("div",{className:"warning-message",style:{background:"rgb(254, 243, 199)",color:"rgb(146, 64, 14)",padding:"1rem",borderRadius:"4px",fontSize:"0.875rem"},children:[e.jsx("strong",{children:"Attenzione:"})," Riceverai due email di conferma: una sulla vecchia email (",c?.email,") e una sulla nuova. Dovrai confermare entrambe per completare il cambio. Fino ad allora continuerai ad accedere con la vecchia email."]}),e.jsx("button",{type:"submit",className:"action-btn",disabled:m,children:m?"Invio in corso...":"Aggiorna Email"})]})]})]})}):null}export{k as EmailChangeOverlay};
