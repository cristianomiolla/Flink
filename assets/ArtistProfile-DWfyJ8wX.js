import{r,s as y,u as M,a as B,b as O,c as T,j as e,S as D,L as f,A as q,P as $}from"./index-wZQoyXLs.js";import{u as Q}from"./TabsNavigation-BdMrOuJ-.js";function U(t){const[o,d]=r.useState(null),[a,h]=r.useState([]),[m,l]=r.useState([]),[N,p]=r.useState(!0),[v,g]=r.useState(null),u=r.useCallback(async()=>{if(!t){p(!1);return}try{p(!0),g(null);const[i,x,j]=await Promise.allSettled([y.from("profiles").select(`
            id,
            user_id,
            email,
            full_name,
            username,
            profile_type,
            bio,
            avatar_url,
            phone,
            location,
            created_at,
            updated_at
          `).eq("user_id",t).eq("profile_type","artist").single(),y.from("portfolio_items").select(`
            id,
            user_id,
            title,
            description,
            image_url,
            tags,
            is_flash,
            price,
            location,
            created_at,
            updated_at
          `).eq("user_id",t).order("created_at",{ascending:!1}),y.from("artist_services").select("*").eq("user_id",t).order("created_at",{ascending:!0})]);if(i.status==="fulfilled"&&!i.value.error)d(i.value.data);else{const n=i.status==="rejected"?i.reason:i.value.error;throw new Error(`Profile not found: ${n.message}`)}x.status==="fulfilled"&&!x.value.error?h(x.value.data||[]):h([]),j.status==="fulfilled"&&!j.value.error?l(j.value.data||[]):l([])}catch(i){g(i.message),d(null),h([]),l([])}finally{p(!1)}},[t]);return r.useEffect(()=>{u()},[u]),{profile:o,portfolioItems:a,services:m,loading:N,error:v,refetch:u}}function W(){const{artistId:t}=M(),o=B(),{profile:d}=O(),{profile:a,portfolioItems:h,services:m,loading:l,error:N}=U(t||""),{fetchFollowerStats:p,getFollowerStats:v,toggleFollow:g}=T(),{reviews:u,stats:i,loading:x,error:j}=Q(t||""),[n,_]=r.useState("portfolio"),w=a?v(a.user_id):null,A=w?.follower_count||0,C=w?.is_following||!1;if(r.useEffect(()=>{window.scrollTo(0,0)},[]),r.useEffect(()=>{a?.user_id&&p([a.user_id])},[a?.user_id,p]),r.useEffect(()=>{if(d&&t&&d.user_id===t){o("/profile",{replace:!0});return}},[d,t,o]),!t)return o("/"),null;const S=h.filter(s=>!s.is_flash),k=h.filter(s=>s.is_flash),E=(s,c)=>{o(`/?search=${encodeURIComponent(s)}&location=${encodeURIComponent(c)}`)},L=()=>{o("/")},I=()=>{t&&o(`/messages/${t}`)},R=async()=>{a?.user_id&&await g(a.user_id)},F=s=>new Date(s).toLocaleDateString("it-IT",{day:"numeric",month:"short",year:"numeric"}),P=s=>{if(!s)return"Cliente Anonimo";const c=s.username||s.full_name;if(!c)return"Cliente Anonimo";const b=c.split(" ");return b.length>1?`${b[0]} ${b[1].charAt(0)}.`:`${c.charAt(0).toUpperCase()}${c.slice(1)}`},z=s=>"‚òÖ".repeat(s)+"‚òÜ".repeat(5-s);return e.jsxs("div",{className:"artist-profile",children:[e.jsx(D,{onSearch:E,onLogoClick:L,hideOnMobile:!0}),e.jsx("main",{className:"artist-profile-content",children:e.jsx("div",{className:"container",children:l?e.jsx("div",{className:"loading-state",children:e.jsx(f,{size:"large"})}):N?e.jsxs("div",{className:"error-state",children:[e.jsx("h2",{children:"Errore nel caricamento del profilo"}),e.jsx("p",{children:N})]}):a?e.jsxs("div",{className:"artist-profile-main",children:[e.jsx("section",{className:"artist-profile-header",children:e.jsxs("div",{className:"profile-info",children:[e.jsx(q,{src:a.avatar_url,name:a.username||a.full_name,alt:`Avatar di ${a.username||a.full_name||"Artista"}`,size:"lg",variant:"bordered"}),e.jsxs("div",{className:"profile-details",children:[e.jsx("h1",{className:"profile-name",children:a.username?e.jsxs(e.Fragment,{children:[a.username,a.full_name&&e.jsxs("span",{className:"profile-real-name",children:[" (",a.full_name,")"]})]}):a.full_name||"Artista Sconosciuto"}),a.location&&e.jsxs("p",{className:"profile-location",children:["üìç ",a.location]}),a.bio&&e.jsx("p",{className:"profile-bio",children:a.bio}),e.jsx("div",{className:"profile-stats",children:e.jsxs("span",{className:"follower-count",children:[e.jsx("strong",{children:A.toLocaleString()})," follower"]})}),e.jsxs("div",{className:"artist-actions",children:[e.jsxs("button",{className:`action-btn ${C?"active":""}`,onClick:R,children:[e.jsx("span",{className:"action-icon",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1",d:"M16 21v-2a4 4 0 00-4-4H6a4 4 0 00-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1",d:"M22 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"})]})}),e.jsx("span",{className:"action-text",children:C?"Seguito":"Segui"})]}),e.jsxs("button",{className:"action-btn",onClick:I,children:[e.jsx("span",{className:"action-icon",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1",d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"})})}),e.jsx("span",{className:"action-text",children:"Contatta"})]})]})]})]})}),e.jsxs("section",{className:"artist-profile-tabs",children:[e.jsxs("div",{className:"tabs-navigation",children:[e.jsxs("button",{className:`tab-button ${n==="portfolio"?"active":""}`,onClick:()=>_("portfolio"),children:[e.jsxs("svg",{className:"tab-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),e.jsx("polyline",{points:"21,15 16,10 5,21"})]}),e.jsx("span",{className:"tab-text",children:"PORTFOLIO"})]}),e.jsxs("button",{className:`tab-button ${n==="flash"?"active":""}`,onClick:()=>_("flash"),children:[e.jsx("svg",{className:"tab-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:e.jsx("polygon",{points:"13,2 3,14 12,14 11,22 21,10 12,10 13,2"})}),e.jsx("span",{className:"tab-text",children:"FLASH"})]}),e.jsxs("button",{className:`tab-button ${n==="servizi"?"active":""}`,onClick:()=>_("servizi"),children:[e.jsx("svg",{className:"tab-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:e.jsx("path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"})}),e.jsx("span",{className:"tab-text",children:"SERVIZI"})]}),e.jsxs("button",{className:`tab-button ${n==="recensioni"?"active":""}`,onClick:()=>_("recensioni"),children:[e.jsx("svg",{className:"tab-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:e.jsx("polygon",{points:"12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26 12,2"})}),e.jsx("span",{className:"tab-text",children:"RECENSIONI"})]})]}),e.jsxs("div",{className:"tab-content",children:[n==="portfolio"&&e.jsxs("div",{className:"tab-panel portfolio-panel",children:[e.jsx("h3",{children:"Realizzati"}),l?e.jsxs("div",{className:"portfolio-loading",children:[e.jsx(f,{size:"large"}),e.jsx("p",{children:"Caricamento portfolio..."})]}):S.length>0?e.jsx("div",{className:"portfolio-grid",children:S.map(s=>e.jsx($,{item:{id:s.id,title:s.title,description:s.description||"",image_url:s.image_url,tags:s.tags||[],is_flash:s.is_flash,price:s.price,location:s.location,created_at:s.created_at,updated_at:s.updated_at,user_id:s.user_id,artist_name:a?.username||a?.full_name||"Artista",full_name:a?.username||a?.full_name||"Artista"},onArtistClick:()=>{}},s.id))}):e.jsx("div",{className:"empty-state",children:e.jsxs("div",{className:"empty-content",children:[e.jsx("div",{className:"empty-icon",children:"üé®"}),e.jsx("h3",{className:"empty-title",children:"Nessun lavoro pubblicato"}),e.jsx("p",{className:"empty-description",children:"Questo artista non ha ancora caricato lavori personalizzati nel suo portfolio."})]})})]}),n==="servizi"&&e.jsxs("div",{className:"tab-panel servizi-panel",children:[e.jsxs("h3",{children:["SERVIZI OFFERTI ",!l&&m.length>0&&`(${m.length})`]}),l?e.jsxs("div",{className:"portfolio-loading",children:[e.jsx(f,{size:"large"}),e.jsx("p",{children:"Caricamento servizi..."})]}):m.length>0?e.jsx("div",{className:"services-list",children:m.map(s=>e.jsxs("div",{className:"service-item",children:[s.image_url&&e.jsx("div",{className:"service-image",children:e.jsx("img",{src:s.image_url,alt:s.name,className:"service-img"})}),e.jsxs("div",{className:"service-info",children:[e.jsx("h4",{children:s.name}),e.jsx("p",{children:s.description||""}),e.jsxs("div",{className:"service-details",children:[s.body_area&&s.body_area!=="N/A"&&e.jsxs("span",{className:"service-detail",children:[e.jsx("strong",{children:"Zona:"})," ",s.body_area]}),s.size_category&&s.size_category!=="N/A"&&e.jsxs("span",{className:"service-detail",children:[e.jsx("strong",{children:"Dimensione:"})," ",s.size_category]})]})]}),e.jsx("div",{className:"service-price",children:s.discount_percentage?e.jsxs("div",{className:"price-with-discount",children:[e.jsx("span",{className:"original-price",children:s.pricing_type==="range"?`‚Ç¨${s.price_min}-${s.price_max}`:s.pricing_type==="fixed"?`‚Ç¨${s.fixed_price}`:"Su consultazione"}),e.jsx("span",{className:"discounted-price",children:s.pricing_type==="range"?`‚Ç¨${Math.round(s.price_min*(100-s.discount_percentage)/100)}-${Math.round(s.price_max*(100-s.discount_percentage)/100)}`:s.pricing_type==="fixed"?`‚Ç¨${Math.round(s.fixed_price*(100-s.discount_percentage)/100)}`:"Su consultazione"})]}):e.jsx("span",{children:s.pricing_type==="range"?`‚Ç¨${s.price_min}-${s.price_max}`:s.pricing_type==="fixed"?`‚Ç¨${s.fixed_price}`:"Su consultazione"})})]},s.id))}):e.jsx("div",{className:"empty-state",children:e.jsxs("div",{className:"empty-content",children:[e.jsx("div",{className:"empty-icon",children:"üõ†Ô∏è"}),e.jsx("h3",{className:"empty-title",children:"Nessun servizio disponibile"}),e.jsx("p",{className:"empty-description",children:"Questo artista non ha ancora pubblicato i suoi servizi."})]})})]}),n==="flash"&&e.jsxs("div",{className:"tab-panel flash-panel",children:[e.jsx("h3",{children:"Flash"}),l?e.jsxs("div",{className:"portfolio-loading",children:[e.jsx(f,{size:"large"}),e.jsx("p",{children:"Caricamento flash..."})]}):k.length>0?e.jsx("div",{className:"portfolio-grid",children:k.map(s=>e.jsx($,{item:{id:s.id,title:s.title,description:s.description||"",image_url:s.image_url,tags:s.tags||[],is_flash:s.is_flash,price:s.price,location:s.location,created_at:s.created_at,updated_at:s.updated_at,user_id:s.user_id,artist_name:a?.username||a?.full_name||"Artista",full_name:a?.username||a?.full_name||"Artista"},onArtistClick:()=>{}},s.id))}):e.jsx("div",{className:"empty-state",children:e.jsxs("div",{className:"empty-content",children:[e.jsx("div",{className:"empty-icon",children:"‚ö°"}),e.jsx("h3",{className:"empty-title",children:"Nessun flash disponibile"}),e.jsx("p",{className:"empty-description",children:"Questo artista non ha ancora caricato disegni flash disponibili."})]})})]}),n==="recensioni"&&e.jsxs("div",{className:"tab-panel recensioni-panel",children:[e.jsxs("h3",{children:["RECENSIONI CLIENTI ",i&&i.total_reviews>0&&`(${i.total_reviews})`]}),x?e.jsxs("div",{className:"portfolio-loading",children:[e.jsx(f,{size:"large"}),e.jsx("p",{children:"Caricamento recensioni..."})]}):j?e.jsx("div",{className:"error-state",children:e.jsx("p",{children:"Errore nel caricamento delle recensioni"})}):u.length>0?e.jsxs(e.Fragment,{children:[i&&e.jsx("div",{className:"reviews-summary",children:e.jsxs("div",{className:"rating-average",children:[e.jsx("span",{className:"artist-rating-number",children:i.average_rating}),e.jsx("div",{className:"rating-stars",children:z(Math.round(i.average_rating))}),e.jsxs("span",{className:"rating-count",children:[i.total_reviews," ",i.total_reviews===1?"recensione":"recensioni"]})]})}),e.jsx("div",{className:"reviews-list",children:u.map(s=>e.jsxs("div",{className:"review-item",children:[e.jsxs("div",{className:"review-header",children:[e.jsxs("div",{className:"reviewer-info",children:[e.jsx("strong",{children:P(s.client_profile)}),e.jsx("div",{className:"review-stars",children:z(s.rating)})]}),e.jsx("span",{className:"review-date",children:F(s.created_at)})]}),s.comment&&e.jsxs("p",{className:"review-text",children:['"',s.comment,'"']})]},s.id))})]}):e.jsx("div",{className:"empty-state",children:e.jsxs("div",{className:"empty-content",children:[e.jsx("div",{className:"empty-icon",children:"‚≠ê"}),e.jsx("h3",{className:"empty-title",children:"Nessuna recensione"}),e.jsx("p",{className:"empty-description",children:"Questo artista non ha ancora ricevuto recensioni dai clienti."})]})})]})]})]})]}):e.jsxs("div",{className:"error-state",children:[e.jsx("h2",{children:"Profilo non trovato"}),e.jsx("p",{children:"L'artista richiesto non √® stato trovato."})]})})})]})}export{W as ArtistProfile};
