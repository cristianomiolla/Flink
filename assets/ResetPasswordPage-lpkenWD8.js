import{a as P,r as l,j as s,M as N,s as p,v as S}from"./index-wZQoyXLs.js";function y(){const m=P(),[e,x]=l.useState({newPassword:"",confirmPassword:""}),[r,i]=l.useState({}),[t,u]=l.useState(!1),[w,h]=l.useState(""),[d,f]=l.useState(null);l.useEffect(()=>{(async()=>{const{data:{session:n}}=await p.auth.getSession();n?f(!0):(f(!1),setTimeout(()=>{m("/")},3e3))})()},[m]);const v=(a,n)=>{x(o=>({...o,[a]:n})),r[a]&&i(o=>{const c={...o};return delete c[a],c}),r.general&&i(o=>{const c={...o};return delete c.general,c})},g=async a=>{if(a.preventDefault(),!(t||!d)){u(!0),i({}),h("");try{const n=S(e.newPassword);if(!n.isValid){i({newPassword:n.errors}),u(!1);return}if(e.newPassword!==e.confirmPassword){i({confirmPassword:"Le password non coincidono"}),u(!1);return}const{error:o}=await p.auth.updateUser({password:e.newPassword});o?i({general:"Errore durante l'aggiornamento della password. Riprova."}):(h("Password aggiornata con successo! Verrai reindirizzato alla home page."),setTimeout(()=>{m("/")},3e3))}catch{i({general:"Errore imprevisto. Riprova."})}finally{u(!1)}}},j=()=>{m("/")};return d===null?s.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:s.jsx("div",{style:{color:"white",fontSize:"1.2rem"},children:"Caricamento..."})}):s.jsxs(s.Fragment,{children:[s.jsx("div",{style:{filter:"blur(2px)",pointerEvents:"none"},children:s.jsx(N,{})}),s.jsx("div",{className:"modal-overlay",children:s.jsxs("div",{className:"modal-content auth-modal",children:[s.jsx("div",{className:"auth-header-sticky",children:s.jsx("button",{className:"modal-close-btn",onClick:j,children:"×"})}),s.jsx("div",{className:"auth-modal-header"}),s.jsxs("div",{className:"auth-content",children:[s.jsxs("div",{className:"header-card",children:[s.jsx("h2",{children:d===!1?"SESSIONE SCADUTA":"REIMPOSTA PASSWORD"}),s.jsx("p",{children:d===!1?"Il link di reset password è scaduto o non valido. Richiedi un nuovo link":"Inserisci la tua nuova password"})]}),d===!1?s.jsx("div",{style:{textAlign:"center",padding:"2rem 0"},children:s.jsx("p",{children:"Verrai reindirizzato alla home page"})}):s.jsxs("form",{className:"auth-form",onSubmit:g,children:[w&&s.jsx("div",{className:"success-message",children:w}),r.general&&s.jsx("div",{className:"form-error general-error",children:r.general}),s.jsxs("div",{className:"form-group",children:[s.jsxs("label",{className:"form-label",htmlFor:"newPassword",children:["Nuova password ",s.jsx("span",{className:"required-indicator",children:"*"})]}),s.jsx("input",{id:"newPassword",type:"password",className:`form-input ${r.newPassword?"error":""}`,value:e.newPassword,onChange:a=>v("newPassword",a.target.value),placeholder:"Inserisci la nuova password",disabled:t}),r.newPassword&&s.jsx("div",{className:"form-errors",children:r.newPassword.map((a,n)=>s.jsx("div",{className:"form-error",children:a},n))}),e.newPassword&&s.jsxs("div",{className:"password-requirements",children:[s.jsx("strong",{children:"Requisiti password:"}),s.jsxs("ul",{children:[s.jsx("li",{className:e.newPassword.length>=8?"valid":"invalid",children:"Almeno 8 caratteri"}),s.jsx("li",{className:/[A-Z]/.test(e.newPassword)?"valid":"invalid",children:"Una lettera maiuscola"}),s.jsx("li",{className:/[a-z]/.test(e.newPassword)?"valid":"invalid",children:"Una lettera minuscola"}),s.jsx("li",{className:/\d/.test(e.newPassword)?"valid":"invalid",children:"Un numero"}),s.jsx("li",{className:/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]/.test(e.newPassword)?"valid":"invalid",children:"Un carattere speciale"})]})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsxs("label",{className:"form-label",htmlFor:"confirmPassword",children:["Conferma nuova password ",s.jsx("span",{className:"required-indicator",children:"*"})]}),s.jsx("input",{id:"confirmPassword",type:"password",className:`form-input ${r.confirmPassword?"error":""}`,value:e.confirmPassword,onChange:a=>v("confirmPassword",a.target.value),placeholder:"Conferma la nuova password",disabled:t}),r.confirmPassword&&s.jsx("div",{className:"form-error",children:r.confirmPassword})]}),s.jsx("button",{type:"submit",className:"action-btn",disabled:t||!e.newPassword.trim()||!e.confirmPassword.trim(),children:t?"Aggiornamento...":"Aggiorna Password"})]})]})]})})]})}export{y as ResetPasswordPage};
