const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CRZ081Ij.js","assets/index-BzcMdIz7.css"])))=>i.map(i=>d[i]);
import{b as T,f as O,r as t,j as e,S as g,L as P,P as z,s as _,_ as L}from"./index-CRZ081Ij.js";/* empty css                       */import{P as M}from"./PageHeader-3WudJlMU.js";import{E as k}from"./EmptyState-C-Wjzl4p.js";const D=t.lazy(()=>L(()=>import("./index-CRZ081Ij.js").then(r=>r.w),__vite__mapDeps([0,1])).then(r=>({default:r.AuthOverlay})));function q({onLogoClick:r,onArtistClick:x}){const{user:i}=T(),{savedTattoos:d,loading:f,refreshSavedTattoos:j}=O(),[s,p]=t.useState([]),[E,n]=t.useState(!0),[l,c]=t.useState(null),[m,v]=t.useState(!1),y=t.useCallback(()=>{v(!0)},[]);return t.useEffect(()=>{window.scrollTo(0,0)},[]),t.useEffect(()=>{(async()=>{if(!i){p([]),n(!1);return}if(f||d.size===0){p([]),n(!1);return}try{n(!0);const h=Array.from(d),{data:S,error:b}=await _.from("saved_tattoos").select("portfolio_item_id, created_at").in("portfolio_item_id",h).order("created_at",{ascending:!1});if(b){c("Errore nel caricamento degli elementi salvati");return}const{data:N,error:A}=await _.from("portfolio_items").select(`
            *,
            profiles!inner(
              user_id,
              full_name,
              username,
              profile_type,
              bio,
              location
            )
          `).in("id",h);if(A){c("Errore nel caricamento degli elementi salvati");return}const I=new Map(N.map(o=>[o.id,o])),w=S.map(o=>{const a=I.get(o.portfolio_item_id);return a?{...a,artist_name:a.profiles.profile_type==="client"?a.profiles.full_name||"Unknown":a.profiles.username||a.profiles.full_name||"Unknown",full_name:a.profiles.profile_type==="client"?a.profiles.full_name:a.profiles.username||a.profiles.full_name,username:a.profiles.username,profile_type:a.profiles.profile_type,bio:a.profiles.bio,artist_location:a.profiles.location}:null}).filter(o=>o!==null);p(w),c(null)}catch{c("Errore nel caricamento degli elementi salvati")}finally{n(!1)}})()},[d,f,i]),E||f?e.jsxs("div",{className:"page-container",children:[e.jsx(g,{onLogoClick:r,hideOnMobile:!0}),e.jsx("div",{className:"page-loading",children:e.jsx(P,{})})]}):e.jsxs("div",{className:"page-container",children:[e.jsx(g,{onLogoClick:r,hideOnMobile:!0}),e.jsxs("div",{className:"container",children:[!l&&s.length===0&&e.jsx(k,{icon:"ðŸ’¾",title:i?"Nessun tatuaggio salvato":"Accedi per visualizzare i tatuaggi salvati",description:i?"Inizia a esplorare i portfolio degli artisti e salva i tatuaggi che ti piacciono.":"Effettua il login per vedere i tatuaggi che hai salvato e gestire la tua collezione personale.",action:e.jsx("button",{className:"action-btn",onClick:i?r:y,style:{marginTop:"1.5rem"},children:i?"Esplora Portfolio":"Accedi"})}),(s.length>0||l)&&e.jsxs("div",{className:"page-content",children:[s.length>0&&e.jsx(M,{title:"ELEMENTI SALVATI",subtitle:s.length===1?"1 elemento salvato":`${s.length} elementi salvati`}),l&&e.jsx("div",{className:"error-state",children:e.jsxs("div",{className:"error-content",children:[e.jsx("p",{className:"error-message",children:l}),e.jsx("button",{className:"btn btn-accent retry-btn",onClick:()=>j(),style:{marginTop:"1.5rem"},children:"Riprova"})]})}),!l&&s.length>0&&e.jsx("div",{className:"portfolio-grid",children:s.map(u=>e.jsx(z,{item:u,onArtistClick:x},u.id))})]})]}),m&&e.jsx(t.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(D,{isOpen:m,onClose:()=>v(!1)})})]})}export{q as SavedItemsPage};
