import{b as y,r as s,j as e,s as w}from"./index-wZQoyXLs.js";function S({isOpen:l,onClose:u}){const{user:f,profile:t,refreshProfile:x}=y(),[r,d]=s.useState({newFullName:""}),[n,o]=s.useState({}),[c,h]=s.useState(!1),[N,v]=s.useState("");s.useEffect(()=>{l?d({newFullName:t?.full_name||""}):(d({newFullName:t?.full_name||""}),o({}),v(""))},[l,t?.full_name]),s.useEffect(()=>(l?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[l]),s.useEffect(()=>{const a=i=>{i.key==="Escape"&&u()};return l&&document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[l,u]);const j=()=>{const a={};return r.newFullName.trim()?r.newFullName.trim()===t?.full_name?a.newFullName="Il nuovo nome deve essere diverso da quello attuale":r.newFullName.trim().length<2&&(a.newFullName="Il nome deve essere di almeno 2 caratteri"):a.newFullName="Nome completo richiesto",o(a),Object.keys(a).length===0},p=async a=>{if(a.preventDefault(),!!j()&&!(c||!f||!t)){h(!0),o({});try{const{error:i}=await w.from("profiles").update({full_name:r.newFullName.trim(),updated_at:new Date().toISOString()}).eq("user_id",f.id);if(i){o({general:"Errore durante l'aggiornamento del profilo: "+i.message});return}const{error:m}=await w.auth.updateUser({data:{full_name:r.newFullName.trim()}});v("Nome aggiornato con successo!"),await x(),setTimeout(()=>{u()},2e3)}catch{o({general:"Si è verificato un errore. Riprova."})}finally{h(!1)}}},F=(a,i)=>{d(m=>({...m,[a]:i})),n[a]&&o(m=>{const g={...m};return delete g[a],g})},b=a=>{a.target===a.currentTarget&&u()};return l?e.jsx("div",{className:"modal-overlay",onClick:b,children:e.jsxs("div",{className:"modal-content auth-modal",children:[e.jsx("div",{className:"auth-header-sticky",children:e.jsx("button",{className:"modal-close-btn",onClick:u,children:"×"})}),e.jsx("div",{className:"auth-modal-header"}),e.jsxs("div",{className:"auth-content",children:[e.jsxs("div",{className:"header-card",children:[e.jsx("h2",{children:"CAMBIA NOME"}),e.jsx("p",{children:"Aggiorna il nome visualizzato sul tuo profilo. Questo nome sarà visibile agli altri utenti"})]}),n.general&&e.jsx("div",{className:"auth-error",children:n.general}),N&&e.jsx("div",{className:"auth-success",children:N}),e.jsxs("form",{className:"auth-form",onSubmit:p,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Nome attuale"}),e.jsx("div",{className:"current-email-display",children:t?.full_name||"N/A"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"form-label",htmlFor:"newFullName",children:["Nuovo nome ",e.jsx("span",{className:"required-indicator",children:"*"})]}),e.jsx("input",{id:"newFullName",type:"text",className:`form-input ${n.newFullName?"error":""}`,value:r.newFullName,onChange:a=>F("newFullName",a.target.value),placeholder:"Inserisci il nuovo nome completo",disabled:c}),n.newFullName&&e.jsx("div",{className:"form-error",children:n.newFullName})]}),e.jsx("button",{type:"submit",className:"action-btn",disabled:c||!r.newFullName.trim(),children:c?"Salvataggio...":"Aggiorna Nome"})]})]})]})}):null}export{S as FullNameChangeOverlay};
