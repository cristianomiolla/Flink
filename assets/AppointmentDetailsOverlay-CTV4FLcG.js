import{q as ne,b as ie,r as o,j as e,s as I}from"./index-wZQoyXLs.js";var le=ne();function re({isOpen:C,onClose:v,userType:N,artistName:F,clientName:z,artistId:R,bookingId:p,onBookingUpdated:f,showParticipants:$=!1}){const{user:j}=ie(),[t,D]=o.useState(null),[L,q]=o.useState(!0),[G,S]=o.useState(!1),[M,P]=o.useState(!1),[n,u]=o.useState({appointment_date:"",appointment_time:"",appointment_duration:"",deposit_amount:"",total_amount:"",artist_notes:""}),[B,H]=o.useState(!1),[y,g]=o.useState(!1),[T,_]=o.useState(!1),[d,A]=o.useState({});o.useEffect(()=>{C&&(async()=>{if(!p){q(!1);return}try{const{data:s,error:i}=await I.from("bookings").select("*").eq("id",p).maybeSingle();if(!i){if(s){D(s);const l=s.appointment_date?new Date(s.appointment_date):null;u({appointment_date:l?l.toISOString().slice(0,10):"",appointment_time:l?l.toTimeString().slice(0,5):"",appointment_duration:s.appointment_duration?.toString()||"",deposit_amount:s.deposit_amount?.toString()||"",total_amount:s.total_amount?.toString()||"",artist_notes:s.artist_notes||""})}}}catch{}finally{q(!1)}})()},[p,C]),o.useEffect(()=>{const a=s=>{(y||T)&&(s.target.closest(".custom-dropdown")||(g(!1),_(!1)))};return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[y,T]);const r=j&&t&&(R?j.id===R:j.id===t.artist_id),U=()=>{if(!t)return!1;const a=t.appointment_date?new Date(t.appointment_date):null,s=a?a.toISOString().slice(0,10):"",i=a?a.toTimeString().slice(0,5):"",l=t.appointment_duration?.toString()||"",w=t.deposit_amount?.toString()||"",O=t.total_amount?.toString()||"",m=t.artist_notes||"";return n.appointment_date!==s||n.appointment_time!==i||n.appointment_duration!==l||n.deposit_amount!==w||n.total_amount!==O||n.artist_notes!==m},c=()=>N!=="artist"||t?.status==="cancelled"||t?.status==="completed"?!1:t?.appointment_date?new Date(t.appointment_date)>new Date:!0;if(!C)return null;const V=a=>a?new Date(a).toLocaleDateString("it-IT",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Data da confermare",Q=()=>{if(!t?.appointment_duration)return"";const a=Math.floor(t.appointment_duration/60),s=t.appointment_duration%60;return a>0&&s>0?`${a}h ${s}min`:a>0?`${a}h`:`${s}min`},W=()=>t?.created_at?new Date(t.created_at).toLocaleString("it-IT",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",k=()=>{if(L||!t)return{text:"Caricamento...",icon:"⏳",className:"pending"};switch(t.status){case"pending":return{text:"In attesa",icon:"⏳",className:"pending"};case"expired":return{text:"Scaduta",icon:"⏰",className:"expired"};case"scheduled":return{text:"Programmato",icon:"✅",className:"accepted"};case"rescheduled":return{text:"Modificato",icon:"🔄",className:"accepted"};case"cancelled":return{text:"Cancellato",icon:"🚫",className:"declined"};case"completed":return{text:"Completato",icon:"🎉",className:"accepted"};default:return{text:"In attesa",icon:"⏳",className:"pending"}}},Z=()=>n.appointment_date&&n.appointment_time&&n.total_amount&&n.deposit_amount,J=()=>{const a={};if(n.total_amount){const s=parseFloat(n.total_amount);s<=0?a.total_amount="Il prezzo deve essere maggiore di zero":s%10!==0&&(a.total_amount="Il prezzo deve essere un multiplo di 10 (es. 50, 100, 200)")}if(n.deposit_amount){const s=parseFloat(n.deposit_amount);s<=0?a.deposit_amount="L'acconto deve essere maggiore di zero":s%10!==0&&(a.deposit_amount="L'acconto deve essere un multiplo di 10 (es. 50, 100, 200)")}return A(a),Object.keys(a).length===0},b=a=>{d[a]&&A(s=>{const i={...s};return delete i[a],i})},K=async()=>{if(!(!p||!j)&&!(!Z()||!J())){H(!0);try{const a={updated_at:new Date().toISOString()},s=t?.appointment_date?new Date(t.appointment_date):null,i=s?s.toISOString().slice(0,10):"",l=s?s.toTimeString().slice(0,5):"";let w=!1;if(n.appointment_date&&n.appointment_time){const m=new Date(`${n.appointment_date}T${n.appointment_time}`);a.appointment_date=m.toISOString(),(n.appointment_date!==i||n.appointment_time!==l)&&(w=!0)}n.appointment_duration&&(a.appointment_duration=parseInt(n.appointment_duration)),n.deposit_amount&&(a.deposit_amount=parseFloat(n.deposit_amount)),n.total_amount&&(a.total_amount=parseFloat(n.total_amount)),n.artist_notes!==void 0&&(a.artist_notes=n.artist_notes),w&&t?.status==="scheduled"&&(a.status="rescheduled");const{error:O}=await I.from("bookings").update(a).eq("id",p);if(O){alert("Errore durante la modifica dell'appuntamento. Riprova.");return}if(D(m=>m?{...m,...a}:null),A({}),f&&f(),v(),a.appointment_date){const m=new Date(a.appointment_date);u(se=>({...se,appointment_date:m.toISOString().slice(0,10),appointment_time:m.toTimeString().slice(0,5)}))}}catch{alert("Errore durante la modifica dell'appuntamento. Riprova.")}finally{H(!1)}}},X=()=>{S(!0)},h=a=>{u(s=>({...s,appointment_time:a})),g(!1),b("appointment_time")},Y=()=>{g(a=>!a),_(!1)},x=a=>{u(s=>({...s,appointment_duration:a})),_(!1)},ee=()=>{_(a=>!a),g(!1)},te=a=>{if(!a)return"1 ora";const s=parseInt(a);if(s>=60){const i=Math.floor(s/60),l=s%60;return l===0?`${i} ${i===1?"ora":"ore"}`:`${i}h ${l}min`}return`${s} min`},ae=async()=>{if(!(!p||!j)){P(!0);try{const{error:a}=await I.from("bookings").update({status:"cancelled",updated_at:new Date().toISOString()}).eq("id",p);if(a){alert("Errore durante la cancellazione dell'appuntamento. Riprova.");return}D(s=>s?{...s,status:"cancelled"}:null),f&&f(),S(!1),v()}catch{alert("Errore durante la cancellazione dell'appuntamento. Riprova.")}finally{P(!1)}}},E=()=>{S(!1)};return le.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-overlay",onClick:a=>a.target===a.currentTarget&&v(),children:e.jsxs("div",{className:"modal-content auth-modal",children:[e.jsx("div",{className:"auth-header-sticky",children:e.jsx("button",{className:"modal-close-btn",onClick:v,children:"×"})}),e.jsx("div",{className:"auth-modal-header"}),e.jsxs("div",{className:"auth-content",children:[e.jsxs("div",{className:"header-card",children:[e.jsxs("h2",{children:["DETTAGLI ",t?.status==="scheduled"||t?.status==="rescheduled"||t?.status==="completed"?"APPUNTAMENTO":"RICHIESTA"]}),e.jsx("p",{children:t?.status==="completed"?"Tattoo completato con successo":t?.status==="scheduled"?"Il tuo appuntamento è stato confermato":t?.status==="rescheduled"?"Il tuo appuntamento è stato modificato":t?.status==="pending"?"La tua richiesta è in attesa di risposta":t?.status==="expired"?"La tua richiesta è scaduta":t?.status==="cancelled"?"Appuntamento cancellato":"Dettagli della richiesta"})]}),e.jsxs("div",{className:"auth-form",children:[L?e.jsx("div",{className:"detail-item",children:e.jsx("div",{className:"detail-value",children:"Caricamento dati appuntamento..."})}):t?e.jsxs(e.Fragment,{children:[$&&N==="client"&&F&&e.jsxs("div",{className:"detail-item",children:[e.jsx("div",{className:"detail-label",children:"Artista"}),e.jsx("div",{className:"detail-value",children:F})]}),$&&N==="artist"&&z&&e.jsxs("div",{className:"detail-item",children:[e.jsx("div",{className:"detail-label",children:"Cliente"}),e.jsx("div",{className:"detail-value",children:z})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("div",{className:"detail-label",children:"Soggetto"}),e.jsx("div",{className:"detail-value",children:t.subject})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("div",{className:"detail-label",children:"Status"}),e.jsxs("div",{className:`detail-value ${k().className}`,children:[e.jsx("span",{className:"status-icon",children:k().icon}),k().text]})]}),t.status!=="scheduled"&&t.status!=="rescheduled"&&t.status!=="completed"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("div",{className:"detail-label",children:"Soggetto"}),e.jsx("div",{className:"detail-value",children:t.subject})]}),t.tattoo_style&&e.jsxs("div",{className:"detail-item",children:[e.jsx("div",{className:"detail-label",children:"Stile"}),e.jsx("div",{className:"detail-value",children:t.tattoo_style})]}),t.body_area&&e.jsxs("div",{className:"detail-item",children:[e.jsx("div",{className:"detail-label",children:"Zona"}),e.jsx("div",{className:"detail-value",children:t.body_area})]}),t.size_category&&e.jsxs("div",{className:"detail-item",children:[e.jsx("div",{className:"detail-label",children:"Dimensioni"}),e.jsx("div",{className:"detail-value",children:t.size_category})]}),t.color_preferences&&e.jsxs("div",{className:"detail-item",children:[e.jsx("div",{className:"detail-label",children:"Colore"}),e.jsx("div",{className:"detail-value",children:t.color_preferences})]}),(t.budget_min||t.budget_max)&&e.jsxs("div",{className:"detail-item",children:[e.jsx("div",{className:"detail-label",children:"Budget"}),e.jsx("div",{className:"detail-value budget",children:t.budget_min&&t.budget_max?`€${t.budget_min} - €${t.budget_max}`:t.budget_min?`da €${t.budget_min}`:`fino a €${t.budget_max}`})]}),t.meaning&&e.jsxs("div",{className:"detail-item",children:[e.jsx("div",{className:"detail-label",children:"Significato"}),e.jsx("div",{className:"detail-value",children:t.meaning})]}),t.reference_images&&t.reference_images.length>0&&e.jsxs("div",{className:"detail-item",children:[e.jsx("div",{className:"detail-label",children:"Riferimenti"}),e.jsx("div",{className:"detail-value",children:e.jsx("div",{className:"reference-images-container",style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",marginTop:"0.5rem"},children:t.reference_images.map((a,s)=>e.jsx("div",{className:"reference-image",children:e.jsx("img",{src:a,alt:`Riferimento ${s+1}`,style:{width:"60px",height:"60px",objectFit:"cover",borderRadius:"4px",cursor:"pointer",border:"1px solid #ddd"},onClick:()=>window.open(a,"_blank")})},s))})})]})]}),t.appointment_date&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"detail-item",children:r&&c()?e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"form-label",children:["DATA APPUNTAMENTO ",e.jsx("span",{className:"required-indicator",children:"*"})]}),e.jsx("input",{type:"date",className:"form-input",value:n.appointment_date,onChange:a=>{u(s=>({...s,appointment_date:a.target.value})),b("appointment_date")},min:new Date().toISOString().slice(0,10),required:!0}),d.appointment_date&&e.jsx("div",{className:"form-error",children:d.appointment_date})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"detail-label",children:"Data e Ora"}),e.jsx("div",{className:"detail-value",children:V(t.appointment_date)})]})}),r&&c()&&e.jsx("div",{className:"detail-item",children:e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"form-label",children:["ORARIO APPUNTAMENTO ",e.jsx("span",{className:"required-indicator",children:"*"})]}),e.jsxs("div",{className:"custom-dropdown ",children:[e.jsxs("button",{type:"button",className:"dropdown-trigger",onClick:Y,children:[e.jsx("span",{className:"dropdown-text",children:n.appointment_time||"Seleziona orario"}),e.jsx("svg",{className:"dropdown-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:e.jsx("polyline",{points:"6,9 12,15 18,9"})})]}),y&&e.jsxs("div",{className:"dropdown-menu select-dropdown-menu",children:[e.jsx("div",{className:"dropdown-item",onClick:()=>h("09:00"),children:"09:00"}),e.jsx("div",{className:"dropdown-item",onClick:()=>h("10:00"),children:"10:00"}),e.jsx("div",{className:"dropdown-item",onClick:()=>h("11:00"),children:"11:00"}),e.jsx("div",{className:"dropdown-item",onClick:()=>h("14:00"),children:"14:00"}),e.jsx("div",{className:"dropdown-item",onClick:()=>h("15:00"),children:"15:00"}),e.jsx("div",{className:"dropdown-item",onClick:()=>h("16:00"),children:"16:00"}),e.jsx("div",{className:"dropdown-item",onClick:()=>h("17:00"),children:"17:00"})]})]}),d.appointment_time&&e.jsx("div",{className:"form-error",children:d.appointment_time})]})})]}),t.appointment_duration&&e.jsx("div",{className:"detail-item",children:r&&c()?e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"DURATA APPUNTAMENTO"}),e.jsxs("div",{className:"custom-dropdown ",children:[e.jsxs("button",{type:"button",className:"dropdown-trigger",onClick:ee,children:[e.jsx("span",{className:"dropdown-text",children:te(n.appointment_duration)}),e.jsx("svg",{className:"dropdown-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:e.jsx("polyline",{points:"6,9 12,15 18,9"})})]}),T&&e.jsxs("div",{className:"dropdown-menu select-dropdown-menu",children:[e.jsx("div",{className:"dropdown-item",onClick:()=>x("30"),children:"30 min"}),e.jsx("div",{className:"dropdown-item",onClick:()=>x("60"),children:"1 ora"}),e.jsx("div",{className:"dropdown-item",onClick:()=>x("90"),children:"1h 30min"}),e.jsx("div",{className:"dropdown-item",onClick:()=>x("120"),children:"2 ore"}),e.jsx("div",{className:"dropdown-item",onClick:()=>x("180"),children:"3 ore"}),e.jsx("div",{className:"dropdown-item",onClick:()=>x("240"),children:"4 ore"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"detail-label",children:"Durata"}),e.jsx("div",{className:"detail-value",children:Q()})]})}),(t.total_amount||r&&c())&&e.jsx("div",{className:"detail-item",children:r&&c()?e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"form-label",children:["PREZZO TOTALE TATUAGGIO (€) ",e.jsx("span",{className:"required-indicator",children:"*"})]}),e.jsx("input",{type:"number",className:"form-input",placeholder:"Es. 200",value:n.total_amount,onChange:a=>{u(s=>({...s,total_amount:a.target.value})),b("total_amount")},min:"10",step:"10",required:!0}),d.total_amount&&e.jsx("div",{className:"form-error",children:d.total_amount})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"detail-label",children:"Prezzo Totale"}),e.jsxs("div",{className:"detail-value budget",children:["€",t.total_amount]})]})}),(t.deposit_amount||r&&c())&&e.jsx("div",{className:"detail-item",children:r&&c()?e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"form-label",children:["ACCONTO RICHIESTO (€) ",e.jsx("span",{className:"required-indicator",children:"*"})]}),e.jsx("input",{type:"number",className:"form-input",placeholder:"Es. 50",value:n.deposit_amount,onChange:a=>{u(s=>({...s,deposit_amount:a.target.value})),b("deposit_amount")},min:"10",step:"10",required:!0}),d.deposit_amount&&e.jsx("div",{className:"form-error",children:d.deposit_amount})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"detail-label",children:"Acconto"}),e.jsxs("div",{className:"detail-value budget",children:["€",t.deposit_amount]})]})}),(t.artist_notes||r&&c())&&e.jsx("div",{className:"detail-item",children:r&&c()?e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"NOTE/INDICAZIONI"}),e.jsx("textarea",{className:"form-textarea",placeholder:"Note aggiuntive per il cliente (preparazione, materiali necessari, etc.)",value:n.artist_notes,onChange:a=>u(s=>({...s,artist_notes:a.target.value})),rows:4,maxLength:500}),e.jsxs("div",{className:"char-count",children:[n.artist_notes.length,"/500 caratteri"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"detail-label",children:"Note Artista"}),e.jsx("div",{className:"detail-value",children:t.artist_notes})]})})]}):e.jsx("div",{className:"detail-item",children:e.jsx("div",{className:"detail-value",children:"Errore nel caricamento dei dati."})}),t&&e.jsx("div",{className:"booking-footer",children:e.jsxs("span",{children:[t.status==="scheduled"||t.status==="rescheduled"||t.status==="completed"?"Appuntamento creato il":"Richiesta creata il"," ",W()]})}),r&&N==="artist"&&t?.status!=="cancelled"&&t?.status!=="completed"&&e.jsx("div",{className:"form-actions",children:U()?e.jsxs("button",{type:"button",className:"action-btn",onClick:K,disabled:B||!Z(),children:[e.jsxs("svg",{className:"action-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[e.jsx("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}),e.jsx("polyline",{points:"17,21 17,13 7,13 7,21"}),e.jsx("polyline",{points:"7,3 7,8 15,8"})]}),e.jsx("span",{className:"action-text",children:B?"Salvando...":"Salva"})]}):e.jsxs("button",{type:"button",className:"action-btn",onClick:X,children:[e.jsx("svg",{className:"action-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})}),e.jsx("span",{className:"action-text",children:"Cancella"})]})})]})]})]})}),G&&e.jsx("div",{className:"modal-overlay",onClick:a=>a.target===a.currentTarget&&E(),children:e.jsxs("div",{className:"modal-content auth-modal",children:[e.jsx("div",{className:"auth-header-sticky",children:e.jsx("button",{className:"modal-close-btn",onClick:E,children:"×"})}),e.jsx("div",{className:"auth-modal-header"}),e.jsxs("div",{className:"auth-content",children:[e.jsxs("div",{className:"header-card",children:[e.jsx("h2",{children:"CANCELLA APPUNTAMENTO"}),e.jsx("p",{children:"Sei sicuro di voler cancellare questo appuntamento? Questa azione non può essere annullata."})]}),e.jsx("form",{className:"auth-form",onSubmit:a=>{a.preventDefault(),ae()},children:e.jsxs("div",{className:"form-actions",children:[e.jsxs("button",{type:"button",className:"action-btn",onClick:E,children:[e.jsx("span",{className:"action-icon",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})}),e.jsx("span",{className:"action-text",children:"Annulla"})]}),e.jsxs("button",{type:"submit",className:"action-btn",disabled:M,children:[e.jsx("span",{className:"action-icon",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[e.jsx("polyline",{points:"3,6 5,6 21,6"}),e.jsx("path",{d:"m19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"}),e.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),e.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})}),e.jsx("span",{className:"action-text",children:M?"Cancellazione...":"Cancella"})]})]})})]})]})})]}),document.body)}export{re as A};
