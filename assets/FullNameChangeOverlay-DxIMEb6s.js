import{u as y,r,j as e,s as w}from"./index-D6Da1cw0.js";function S({isOpen:l,onClose:m}){const{user:f,profile:s,refreshProfile:x}=y(),[t,d]=r.useState({newFullName:""}),[n,o]=r.useState({}),[c,h]=r.useState(!1),[N,v]=r.useState("");r.useEffect(()=>{l?d({newFullName:s?.full_name||""}):(d({newFullName:s?.full_name||""}),o({}),v(""))},[l,s?.full_name]),r.useEffect(()=>(l?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[l]),r.useEffect(()=>{const a=i=>{i.key==="Escape"&&m()};return l&&document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[l,m]);const p=()=>{const a={};return t.newFullName.trim()?t.newFullName.trim()===s?.full_name?a.newFullName="Il nuovo nome deve essere diverso da quello attuale":t.newFullName.trim().length<2&&(a.newFullName="Il nome deve essere di almeno 2 caratteri"):a.newFullName="Nome completo richiesto",o(a),Object.keys(a).length===0},j=async a=>{if(a.preventDefault(),!!p()&&!(c||!f||!s)){h(!0),o({});try{const{error:i}=await w.from("profiles").update({full_name:t.newFullName.trim(),updated_at:new Date().toISOString()}).eq("user_id",f.id);if(i){o({general:"Errore durante l'aggiornamento del profilo: "+i.message});return}const{error:u}=await w.auth.updateUser({data:{full_name:t.newFullName.trim()}});u&&console.warn("Warning: Could not update auth metadata:",u.message),v("Nome aggiornato con successo!"),await x(),setTimeout(()=>{m()},2e3)}catch{o({general:"Si è verificato un errore. Riprova."})}finally{h(!1)}}},F=(a,i)=>{d(u=>({...u,[a]:i})),n[a]&&o(u=>{const g={...u};return delete g[a],g})},b=a=>{a.target===a.currentTarget&&m()};return l?e.jsx("div",{className:"auth-overlay",onClick:b,children:e.jsxs("div",{className:"auth-modal",children:[e.jsx("div",{className:"auth-header-sticky",children:e.jsx("button",{className:"auth-close-btn",onClick:m,children:"×"})}),e.jsx("div",{className:"auth-modal-header"}),e.jsxs("div",{className:"auth-content",children:[e.jsxs("div",{className:"header-card",children:[e.jsx("h2",{children:"CAMBIA NOME"}),e.jsx("p",{children:"Aggiorna il nome visualizzato sul tuo profilo. Questo nome sarà visibile agli altri utenti"})]}),n.general&&e.jsx("div",{className:"auth-error",children:n.general}),N&&e.jsx("div",{className:"auth-success",children:N}),e.jsxs("form",{className:"auth-form",onSubmit:j,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Nome attuale"}),e.jsx("div",{className:"current-email-display",children:s?.full_name||"N/A"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"form-label",htmlFor:"newFullName",children:["Nuovo nome ",e.jsx("span",{className:"required-indicator",children:"*"})]}),e.jsx("input",{id:"newFullName",type:"text",className:`form-input ${n.newFullName?"error":""}`,value:t.newFullName,onChange:a=>F("newFullName",a.target.value),placeholder:"Inserisci il nuovo nome completo",disabled:c}),n.newFullName&&e.jsx("div",{className:"form-error",children:n.newFullName})]}),e.jsx("button",{type:"submit",className:"action-btn",disabled:c,children:c?"Salvataggio...":"Aggiorna Nome"})]})]})]})}):null}export{S as FullNameChangeOverlay};
