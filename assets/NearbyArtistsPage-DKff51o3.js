const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-wZQoyXLs.js","assets/index-BzcMdIz7.css"])))=>i.map(i=>d[i]);
import{a as D,b as I,i as L,c as R,l as q,r as t,j as e,S as A,L as B,k as M,m as $,n as F,o as H,_ as U}from"./index-wZQoyXLs.js";/* empty css                       */import{P as V}from"./PageHeader-DpnbwZl0.js";import{E as j}from"./EmptyState-DRbgyEKE.js";const W=t.lazy(()=>U(()=>import("./index-wZQoyXLs.js").then(n=>n.w),__vite__mapDeps([0,1])).then(n=>({default:n.AuthOverlay})));function X({onLogoClick:n}){const l=D(),{profile:p}=I(),{artistProfiles:r,loading:C,error:c}=L(),{fetchFollowerStats:b}=R(),{location:o,requestLocation:h,error:m}=q(),[z,y]=t.useState(!1),[i,g]=t.useState([]),[u,f]=t.useState(!1),S=t.useCallback(()=>{y(!0)},[]),E=t.useCallback(s=>{l(`/messages/${s}`)},[l]),P=t.useCallback(s=>{p&&p.user_id===s?l("/profile"):l(`/artist/${s}`)},[l,p]);t.useEffect(()=>{window.scrollTo(0,0)},[]),t.useEffect(()=>{!o&&!m&&h()},[o,m,h]),t.useEffect(()=>{if(r.length>0){const s=r.map(d=>d.user_id);b(s)}},[r,b]),t.useEffect(()=>{(async()=>{if(!o||r.length===0){g([]);return}f(!0);try{const d=Array.from(new Set(r.map(a=>a.location).filter(a=>!!a?.trim())));if(d.length===0){g([]),f(!1);return}const T=await F(d),_=r.map(a=>{const x=a.location?T.get(a.location):null;return x?{...a,coordinates:{latitude:x.latitude,longitude:x.longitude}}:null}).filter(a=>a!==null),k={latitude:o.latitude,longitude:o.longitude},O=H(_,k,250);g(O)}catch(d){console.warn("Error calculating nearby artists:",d),g([])}finally{f(!1)}})()},[o,r]);const v=o!==null&&m?.code!==1,N=m?.code===1,w=t.useMemo(()=>u?"Calcolando distanze...":i.length===0?"Nessun artista trovato nelle vicinanze":i.length===1?"1 artista nelle vicinanze":`${i.length} artisti nelle vicinanze`,[i.length,u]);return C||u?e.jsxs("div",{className:"page-container",children:[e.jsx(A,{onLogoClick:n,hideOnMobile:!0}),e.jsxs("div",{className:"page-loading",children:[e.jsx(B,{}),u&&e.jsx("p",{style:{textAlign:"center",marginTop:"1rem",color:"#666"},children:"Calcolando artisti nelle vicinanze..."})]})]}):e.jsxs("div",{className:"saved-items-page",children:[e.jsx(A,{onLogoClick:n,hideOnMobile:!0}),e.jsxs("div",{className:"container",children:[N&&e.jsx(j,{icon:"📍",title:"Posizione non disponibile",description:"Per vedere gli artisti vicini a te, abilita la geolocalizzazione nelle impostazioni del browser.",action:e.jsx("button",{className:"action-btn",onClick:h,style:{marginTop:"1.5rem"},children:"Riprova geolocalizzazione"})}),!c&&!N&&!v&&e.jsx(j,{icon:"🗺️",title:"Geolocalizzazione richiesta",description:"Per scoprire gli artisti vicini a te, autorizza l'accesso alla tua posizione.",action:e.jsx("button",{className:"action-btn",onClick:h,style:{marginTop:"1.5rem"},children:"Autorizza posizione"})}),!c&&v&&i.length===0&&!u&&e.jsx(j,{icon:"🎨",title:"Nessun artista nelle vicinanze",description:"Non ci sono artisti entro 250km dalla tua posizione. Prova ad esplorare gli artisti in evidenza.",action:e.jsx("button",{className:"action-btn",onClick:()=>l("/featured-artists"),style:{marginTop:"1.5rem"},children:"Esplora tutti gli artisti"})}),v&&(i.length>0||c)&&e.jsxs("div",{className:"page-content",children:[i.length>0&&e.jsx("div",{className:"header-card",children:e.jsx(V,{title:"ARTISTI VICINI",subtitle:w})}),c&&e.jsx("div",{className:"error-state",children:e.jsxs("div",{className:"error-content",children:[e.jsx("p",{className:"error-message",children:c}),e.jsx("button",{className:"btn btn-accent retry-btn",onClick:n,style:{marginTop:"1.5rem"},children:"Torna alla Home"})]})}),!c&&i.length>0&&e.jsx("div",{className:"artist-grid",children:i.map(s=>e.jsxs("div",{className:"artist-card-with-distance",children:[e.jsx(M,{profile:s,onArtistClick:P,onAuthRequired:S,onContactArtist:E}),e.jsxs("div",{className:"distance-badge",children:["📍 ",$(s.distance)]})]},s.id))})]})]}),z&&e.jsx(t.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(W,{isOpen:z,onClose:()=>y(!1)})})]})}export{X as NearbyArtistsPage};
